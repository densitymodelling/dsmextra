<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Quantify extrapolation in multivariate environmental space — compute_extrapolation • dsmextra</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Quantify extrapolation in multivariate environmental space — compute_extrapolation" />
<meta property="og:description" content="Assesses univariate (Type I) and combinatorial (Type II) extrapolation in spatial ecological models such as density surface models of line transect data. Models are built in a reference (calibration) system and projected into one or more target (prediction) system(s). The function is based on original code from the ecospat package (Broennimann et al. 2016). Although the required inputs mirror those of the dsm package (Miller et al. 2015), the function is not restricted to line/strip-transect data and can be applied to other survey types and predictive modelling scenarios. See the 'Examples' section and Bouchet et al. (2019) for more information." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">dsmextra</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.1.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/dsmextra.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/dsmextra-bigdata.html">Using dsmextra with 'big data': An example, with a note on covariate transformations</a>
    </li>
    <li>
      <a href="../articles/dsmextra-covariateselection.html">A priori covariate selection using dsmextra</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Quantify extrapolation in multivariate environmental space</h1>
    
    <div class="hidden name"><code>compute_extrapolation.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Assesses univariate (Type I) and combinatorial (Type II) extrapolation in spatial ecological models such as density surface models of line transect data. Models are built in a reference (calibration) system and projected into one or more target (prediction) system(s). The function is based on original code from the <a href='https://cran.r-project.org/web/packages/ecospat/index.html'>ecospat</a> package (Broennimann et al. 2016). Although the required inputs mirror those of the <a href='https://cran.r-project.org/web/packages/dsm/index.html'>dsm</a> package (Miller et al. 2015), the function is not restricted to line/strip-transect data and can be applied to other survey types and predictive modelling scenarios. See the 'Examples' section and Bouchet et al. (2019) for more information.</p>
    </div>

    <pre class="usage"><span class='fu'>compute_extrapolation</span>(
  <span class='no'>samples</span>,
  <span class='no'>segments</span>,
  <span class='no'>covariate.names</span>,
  <span class='no'>prediction.grid</span>,
  <span class='no'>coordinate.system</span>,
  <span class='kw'>resolution</span> <span class='kw'>=</span> <span class='kw'>NULL</span>
)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>samples</th>
      <td><p>Sample (reference) dataset used for model building and calibration. This corresponds to the <code>segment.data</code> used when building density surface models in <code>dsm</code>. It must contain one column for each of the covariates in <code>covariate.names</code>.</p></td>
    </tr>
    <tr>
      <th>covariate.names</th>
      <td><p>Character string. Names of the covariates of interest.</p></td>
    </tr>
    <tr>
      <th>prediction.grid</th>
      <td><p>Prediction data.frame. This contains both geographic coordinates (<code>x</code>, <code>y</code>) and covariate values associated with the target locations for which predictions are desired. Typically, these locations are taken as the centroids of the grid cells in a spatial prediction grid/raster. See <code><a href='https://rdrr.io/pkg/dsm/man/predict.dsm.html'>predict.dsm</a></code>.</p></td>
    </tr>
    <tr>
      <th>coordinate.system</th>
      <td><p>Projected coordinate system relevant to the study location. Can be either a character string or an object of class <code><a href='https://rdrr.io/pkg/sp/man/CRS-class.html'>CRS</a></code>.</p></td>
    </tr>
    <tr>
      <th>resolution</th>
      <td><p>Resolution of the output raster (in units relevant to <code>coordinate.system</code>). Only required if <code>prediction.grid</code> is irregular, and thus needs to be rasterised. Defaults to <code>NULL</code>.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A list object containing extrapolation values in both <code>data.frame</code> and <code><a href='https://rdrr.io/pkg/raster/man/raster.html'>raster</a></code> format.</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>The function calculates values of the ExDet (EXtrapolation DETection) metric as originally proposed by Mesgaran et al. (2014). ExDet takes on strictly negative values during univariate extrapolation (i.e. when predictions are made outside the range of individual covariates), is strictly &gt;1 during combinatorial extrapolation (i.e. when predictions are made within the range of individual covariates, but for combinations of environmental conditions not encountered in the sample), and lies within the range 0-1 when predictions are made in conditions analogous to those found in the reference system. The function also determines which covariates make the largest contribution to each type of extrapolation; this is the most influential covariate (MIC). See Mesgaran et al. (2014) for details.</p>
<p>Note that <code>compute_extrapolation</code> returns results in both numerical and raster format. The latter is used to support mapping functions and requires the locations in <code>prediction.grid</code> to be evenly spaced. If this is not the case, <code>dsmextra</code> will attempt to automatically generate a raster with a resolution given by the <code>resolution</code> argument (and expressed in the units of <code>coordinate.system</code>). An error may be returned if no <code>resolution</code> is specified.</p>
<p>The <code>data</code> list captures ExDet values at prediction locations (i.e. cells in <code>prediction.grid</code>) and is organised into multiple <code>data.frame</code> objects, as follows:</p>
<table class='table'>
<tr><td><code>all</code></td><td>All prediction locations</td></tr>
<tr><td><code>univariate</code></td><td>Prediction locations subject to univariate extrapolation (only)</td></tr>
<tr><td><code>combinatorial</code></td><td>Prediction locations subject to combinatorial extrapolation (only)</td></tr>
<tr><td><code>analogue</code></td><td>Prediction locations where conditions are analogous to sampled conditions (only)</td></tr>
</table>


<p>Each <code>data.frame</code> contains four columns:</p>
<p></p><table class='table'>
<tr><td><code>ExDet</code></td><td>ExDet values</td></tr>
<tr><td><code>mic_univariate</code></td><td>Integer identifying the univariate MIC</td></tr>
<tr><td><code>mic_combinatorial</code></td><td>Integer identifying the combinatorial MIC</td></tr>
<tr><td><code>mic</code></td><td>Integer identifying the MIC</td></tr>
</table>


<p>The <code>rasters</code> list comprises two elements, named <code>ExDet</code> and <code>mic</code>. Each contains individual rasters mapping ExDet and MIC values, respectively.</p>
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Bouchet PJ, Miller DL, Roberts JJ, Mannocci L, Harris CM and Thomas L (2019). From here and now to there and then: Practical recommendations for extrapolating cetacean density surface models to novel conditions. CREEM Technical Report 2019-01, 59 p. <a href='https://research-repository.st-andrews.ac.uk/handle/10023/18509'>https://research-repository.st-andrews.ac.uk/handle/10023/18509</a></p>
<p>Broennimann O, Di Cola V, Guisan A (2016). ecospat: Spatial Ecology Miscellaneous Methods. R package version 2.1.1. <a href='https://CRAN.R-project.org/package=ecospat'>https://CRAN.R-project.org/package=ecospat</a></p>
<p>Mesgaran MB, Cousens RD, Webber BL (2014). Here be dragons: a tool for quantifying novelty due to covariate range and correlation change when projecting species distribution models. Diversity &amp; Distributions, 20: 1147-115. DOI: <a href='https://onlinelibrary.wiley.com/doi/full/10.1111/ddi.12209'>10.1111/ddi.12209</a></p>
<p>Miller DL, Rexstad E, Burt L, Bravington MV, Hedley S (2015). dsm: Density Surface Modelling of Distance Sampling Data. R package version 2.2.9. <a href='https://CRAN.R-project.org/package=dsm'>https://CRAN.R-project.org/package=dsm</a></p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='fu'><a href='https://rdrr.io/r/base/library.html'>library</a></span>(<span class='no'>dsmextra</span>)

<span class='co'>#  --- EXAMPLE 1: Line transect surveys of sperm whales ---</span>

<span class='co'># Load the Mid-Atlantic sperm whale data (see ?spermwhales)</span>
<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span>(<span class='no'>spermwhales</span>)

<span class='co'># Extract the data</span>
<span class='no'>segs</span> <span class='kw'>&lt;-</span> <span class='no'>spermwhales</span>$<span class='no'>segs</span>
<span class='no'>predgrid</span> <span class='kw'>&lt;-</span> <span class='no'>spermwhales</span>$<span class='no'>predgrid</span>

<span class='co'># Define relevant coordinate system</span>
<span class='no'>my_crs</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>sp</span><span class='kw ns'>::</span><span class='fu'><a href='https://rdrr.io/pkg/sp/man/CRS-class.html'>CRS</a></span>(<span class='st'>"+proj=aea +lat_1=38 +lat_2=30 +lat_0=34 +lon_0=-73 +x_0=0
 +y_0=0 +datum=WGS84 +units=m +no_defs +ellps=WGS84 +towgs84=0,0,0"</span>)

<span class='co'># Define covariates of interest</span>
<span class='no'>my_cov</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"Depth"</span>, <span class='st'>"DistToCAS"</span>, <span class='st'>"SST"</span>, <span class='st'>"EKE"</span>, <span class='st'>"NPP"</span>)

<span class='co'># Assess extrapolation in the multivariate space defined by five covariates</span>
<span class='no'>spermw.extrapolation</span> <span class='kw'>&lt;-</span> <span class='fu'>compute_extrapolation</span>(<span class='kw'>samples</span> <span class='kw'>=</span> <span class='no'>segs</span>,
      <span class='kw'>covariate.names</span> <span class='kw'>=</span> <span class='no'>my_cov</span>,
      <span class='kw'>prediction.grid</span> <span class='kw'>=</span> <span class='no'>predgrid</span>,
      <span class='kw'>coordinate.system</span> <span class='kw'>=</span> <span class='no'>my_crs</span>)</div><div class='output co'>#&gt; <span class='message'>Computing ...</span></div><div class='output co'>#&gt; <span class='message'>Done!</span></div><div class='input'>
<span class='co'>#  --- EXAMPLE 2: Crowdsourced records of Acacia cyclops (see Mesgaran et al. 2014)  ---</span>

<span class='fu'><a href='https://rdrr.io/r/base/library.html'>library</a></span>(<span class='no'>dsmextra</span>)
<span class='fu'><a href='https://rdrr.io/r/base/library.html'>library</a></span>(<span class='no'>raster</span>)
<span class='fu'><a href='https://rdrr.io/r/base/library.html'>library</a></span>(<span class='no'>sp</span>)
<span class='fu'><a href='https://rdrr.io/r/base/library.html'>library</a></span>(<span class='no'>magrittr</span>)</div><div class='output co'>#&gt; <span class='message'></span>
#&gt; <span class='message'>Attaching package: ‘magrittr’</span></div><div class='output co'>#&gt; <span class='message'>The following object is masked from ‘package:raster’:</span>
#&gt; <span class='message'></span>
#&gt; <span class='message'>    extract</span></div><div class='input'>
<span class='co'># Native and introduced range</span>
<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span>(<span class='no'>acacia</span>)

<span class='co'># Download BioClim data</span>
<span class='no'>r</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>raster</span><span class='kw ns'>::</span><span class='fu'><a href='https://rdrr.io/pkg/raster/man/getData.html'>getData</a></span>(<span class='kw'>name</span> <span class='kw'>=</span> <span class='st'>"worldclim"</span>, <span class='kw'>var</span> <span class='kw'>=</span> <span class='st'>"bio"</span>, <span class='kw'>res</span> <span class='kw'>=</span> <span class='fl'>10</span>)

<span class='co'># Define variables of interest</span>
<span class='no'>bioclim.variables</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"bio1"</span>, <span class='st'>"bio5"</span>, <span class='st'>"bio6"</span>, <span class='st'>"bio12"</span>, <span class='st'>"bio13"</span>, <span class='st'>"bio14"</span>)

<span class='co'># Reference system (South Australia)</span>
<span class='no'>ref</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>raster</span><span class='kw ns'>::</span><span class='fu'><a href='https://rdrr.io/pkg/raster/man/crop.html'>crop</a></span>(<span class='kw'>x</span> <span class='kw'>=</span> <span class='no'>r</span><span class='kw'>[[</span><span class='no'>bioclim.variables</span>]], <span class='kw'>y</span> <span class='kw'>=</span> <span class='no'>acacia</span>$<span class='no'>south_australia</span>) <span class='kw'>%&gt;%</span>
<span class='kw pkg'>raster</span><span class='kw ns'>::</span><span class='fu'><a href='https://rdrr.io/pkg/raster/man/mask.html'>mask</a></span>(<span class='kw'>x</span> <span class='kw'>=</span> <span class='no'>.</span>, <span class='kw'>mask</span> <span class='kw'>=</span> <span class='no'>acacia</span>$<span class='no'>south_australia</span>) <span class='kw'>%&gt;%</span>
<span class='kw pkg'>raster</span><span class='kw ns'>::</span><span class='fu'><a href='https://rdrr.io/pkg/raster/man/as.data.frame.html'>as.data.frame</a></span>(<span class='kw'>x</span> <span class='kw'>=</span> <span class='no'>.</span>, <span class='kw'>xy</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>na.rm</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)

<span class='co'># Target system (South Africa)</span>
<span class='no'>target</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>raster</span><span class='kw ns'>::</span><span class='fu'><a href='https://rdrr.io/pkg/raster/man/crop.html'>crop</a></span>(<span class='kw'>x</span> <span class='kw'>=</span> <span class='no'>r</span><span class='kw'>[[</span><span class='no'>bioclim.variables</span>]], <span class='kw'>y</span> <span class='kw'>=</span> <span class='no'>acacia</span>$<span class='no'>south_africa</span>) <span class='kw'>%&gt;%</span>
<span class='kw pkg'>raster</span><span class='kw ns'>::</span><span class='fu'><a href='https://rdrr.io/pkg/raster/man/mask.html'>mask</a></span>(<span class='kw'>x</span> <span class='kw'>=</span> <span class='no'>.</span>, <span class='kw'>mask</span> <span class='kw'>=</span> <span class='no'>acacia</span>$<span class='no'>south_africa</span>) <span class='kw'>%&gt;%</span>
<span class='kw pkg'>raster</span><span class='kw ns'>::</span><span class='fu'><a href='https://rdrr.io/pkg/raster/man/as.data.frame.html'>as.data.frame</a></span>(<span class='no'>.</span>, <span class='kw'>xy</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>na.rm</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)

<span class='co'># Assess extrapolation</span>
<span class='no'>bioclim.ex</span> <span class='kw'>&lt;-</span> <span class='fu'>compute_extrapolation</span>(<span class='kw'>samples</span> <span class='kw'>=</span> <span class='no'>ref</span>,
                                    <span class='kw'>covariate.names</span> <span class='kw'>=</span> <span class='no'>bioclim.variables</span>,
                                    <span class='kw'>prediction.grid</span> <span class='kw'>=</span> <span class='no'>target</span>,
                                    <span class='kw'>coordinate.system</span> <span class='kw'>=</span> <span class='kw pkg'>sp</span><span class='kw ns'>::</span><span class='fu'><a href='https://rdrr.io/pkg/sp/man/is.projected.html'>proj4string</a></span>(<span class='no'>r</span>))</div><div class='output co'>#&gt; <span class='message'>Computing ...</span></div><div class='output co'>#&gt; <span class='message'>Done!</span></div><div class='input'>
<span class='co'># Make a map</span>
<span class='fu'><a href='map_extrapolation.html'>map_extrapolation</a></span>(<span class='kw'>map.type</span> <span class='kw'>=</span> <span class='st'>"extrapolation"</span>,
                  <span class='kw'>extrapolation.values</span> <span class='kw'>=</span> <span class='no'>bioclim.ex</span>,
                  <span class='kw'>covariate.names</span> <span class='kw'>=</span> <span class='no'>bioclim.variables</span>,
                  <span class='kw'>coordinate.system</span> <span class='kw'>=</span> <span class='kw pkg'>sp</span><span class='kw ns'>::</span><span class='fu'><a href='https://rdrr.io/pkg/sp/man/is.projected.html'>proj4string</a></span>(<span class='no'>r</span>),
                  <span class='kw'>prediction.grid</span> <span class='kw'>=</span> <span class='no'>target</span>)</div><div class='output co'>#&gt; <span class='warning'>Warning: map_extrapolation relies on the leaflet package, which is built around a Web Mercator projection (EPSG:3857), and therefore requires rasters to be reprojected for plotting. As a result, minor discrepancies may  occur between the interactive maps shown in the viewer, and the underlying raw data. The latter can be accessed directly from the extrapolation.values or gower.values objects and visualised using alternative packages such as ggplot2.</span></div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Phil Bouchet, David Miller, Laura Mannocci, Jason Roberts, Catriona Harris, Len Thomas.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


